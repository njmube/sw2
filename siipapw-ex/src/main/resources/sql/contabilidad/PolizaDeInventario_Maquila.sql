select 'Inventario Maquila ' AS DESCRIPCION,'MQH' AS CONCEPTO,E.ALMACEN_ID AS CLAVE,E.ALMACEN_NOMBRE AS ALMACEN,SUM(SH.COSTO) AS COSTO,SUM((SH.CANTIDAD/1000)*(IM.COSTO_CORTE)) AS CORTE,SUM((SH.CANTIDAD/1000)*(IM.COSTO_FLETE)) AS FLETE,(SELECT S.NOMBRE FROM SW_SUCURSALES S WHERE S.SUCURSAL_ID=IM.SUCURSAL_ID) AS SUCURSAL
FROM sx_maq_entradas E JOIN sx_maq_entradasdet ED ON(ED.ENTRADA_ID=E.ENTRADA_ID) JOIN sx_maq_ordenesdet OD ON(OD.ENTRADADET_ID=ED.ENTRADADET_ID) JOIN sx_maq_recepcion_cortedet RC ON(RC.ORDENDET_ID=OD.ORDENDET_ID) JOIN sx_maq_salida_hojeadodet SH ON(SH.RECEPCIONDET_ID=RC.RECEPCIONDET_ID)
JOIN sx_inventario_maq IM ON(IM.INVENTARIO_ID=SH.INVENTARIO_ID) JOIN sx_recepcion_maquila RM ON(RM.ID=IM.RECEPCION_ID) where DATE(IM.FECHA) BETWEEN '@FECHA_INI 00:00:00' AND '@FECHA_FIN 23:59:59'
group by (SELECT S.NOMBRE FROM SW_SUCURSALES S WHERE S.SUCURSAL_ID=IM.SUCURSAL_ID),E.ALMACEN_NOMBRE
UNION
select 'Inventario Maquila ' AS GRUPO,'MQB' AS TIPO,E.ALMACEN_ID AS CLAVE,E.ALMACEN_NOMBRE AS NOMBRE,SUM(SB.CANTIDAD*ED.PRECIO_KILO) AS COSTO,0 as CORTE,SUM(IFNULL(i.COSTO_FLETE*sb.CANTIDAD,0)) as FLETE,(SELECT S.NOMBRE FROM SW_SUCURSALES S WHERE S.SUCURSAL_ID=I.SUCURSAL_ID) AS SUC
FROM sx_maq_entradas E JOIN sx_maq_entradasdet ED ON(ED.ENTRADA_ID=E.ENTRADA_ID) JOIN sx_maq_salida_bobinas SB ON(SB.ENTRADADET_ID=ED.ENTRADADET_ID) JOIN sx_inventario_maq I ON(I.INVENTARIO_ID=SB.INVENTARIO_ID) where I.FECHA BETWEEN '@FECHA_INI 00:00:00' AND '@FECHA_FIN 23:59:59'
GROUP BY (SELECT S.NOMBRE FROM SW_SUCURSALES S WHERE S.SUCURSAL_ID=I.SUCURSAL_ID),E.ALMACEN_NOMBRE